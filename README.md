# 盲拍（Blind Auction）系统

基于区块链的去中心化盲拍系统，支持创建、参与和管理盲拍拍卖。

## 🎯 项目特色

- **完全去中心化**: 基于以太坊智能合约，无需中心化服务器
- **盲拍机制**: 竞拍阶段隐藏真实出价，揭示阶段统一公开，确保公平性
- **IPFS存储**: 拍卖图片采用IPFS分布式存储技术，永久保存且无法篡改
- **现代化UI**: 炫酷的紫黑主题，流畅的动效和出色的用户体验
- **一致性主题**: 🆕 区块浏览器采用统一的深色主题设计，与整体项目风格保持一致
- **优化的区块浏览器**: 🆕 美化了交易表格、搜索栏和分页组件，提升了可读性和用户体验
- **多阶段管理**: 支持未开始、竞拍中、揭示中、已结束四个完整阶段
- **智能缓存**: 前端缓存已结束拍卖，减少API请求，提升性能
- **最低出价显示**: 🆕 首页热门拍卖展示每个拍卖的最低出价，帮助用户快速了解参与门槛

## 🔥 核心功能

### 1. 创建拍卖 ✨
用户可以创建自定义的盲拍拍卖：

**使用方法**：
1. 连接MetaMask钱包
2. 访问"创建拍卖"页面
3. 填写以下信息：
   - **拍卖名称**: 拍卖物品的名称
   - **拍卖描述**: 详细描述拍卖物品
   - **拍卖图片**: 上传图片（自动压缩并存储到IPFS）
   - **最低价格**: 设置最低出价（ETH）
   - **竞拍开始时间**: 🆕 设置拍卖何时开始接受竞拍
   - **竞拍时间**: 竞拍阶段持续时间（分钟）
   - **揭示时间**: 揭示阶段持续时间（分钟）

**新增功能**：
- **竞拍开始时间**: 现在可以设置拍卖的具体开始时间，支持未来时间
- **状态显示**: 未开始的拍卖会显示"未开始"状态标签
- **时间验证**: 系统会验证开始时间必须在当前时间之后

### 2. 查看所有拍卖 📋
浏览和筛选所有平台上的拍卖：

**功能特点**：
- **分页显示**: 每页显示9个拍卖，支持翻页导航
- **状态筛选**: 
  - **未开始** 🆕: 显示尚未开始的拍卖
  - **竞拍中**: 显示正在接受竞拍的拍卖
  - **揭示中**: 显示竞拍结束，正在揭示阶段的拍卖
  - **已结束**: 显示完全结束的拍卖
- **搜索功能**: 根据拍卖名称和描述搜索
- **预览模态框**: 点击拍卖卡片可快速预览详情
- **智能缓存**: 已结束拍卖使用缓存数据，提升加载速度

**状态说明**：
- 🔵 **未开始**: 拍卖已创建但尚未到开始时间，无法竞拍
- 🟢 **竞拍中**: 可以提交盲拍出价
- 🟡 **揭示中**: 竞拍结束，可以揭示真实出价
- 🔴 **已结束**: 拍卖完全结束，可查看最终结果

### 3. 我的拍卖 👤
管理用户创建和参与的拍卖：

**两个标签页**：
- **我创建的**: 查看自己创建的所有拍卖
- **我参与的**: 查看自己参与竞拍的拍卖

**缓存优化**: 已结束的拍卖使用本地缓存，快速加载

### 4. 参与竞拍 🎯
在拍卖详情页面参与竞拍：

**竞拍流程**：
1. **竞拍阶段**: 
   - 提交加密的盲拍出价
   - 出价金额被隐藏，仅自己可见
   - 需要提供押金（不少于出价金额）
2. **揭示阶段**:
   - 公开真实出价信息
   - 系统验证出价合法性
   - 自动返还无效出价的押金
3. **结束阶段**:
   - 查看最终拍卖结果
   - 获胜者支付最高出价
   - 其他参与者取回押金

### 5. 出价管理 💰
系统自动管理出价和押金：

**押金处理**：
- **竞拍期间**: 押金被合约锁定
- **揭示成功**: 
  - 有效出价：押金转为正式出价
  - 无效出价：自动返还押金
- **非最高出价**: 可以手动取回押金
- **最高出价**: 自动转给拍卖创建者

### 6. NFT文件下载 📥
通过IPFS CID下载NFT文件：

**功能特点**：
- **多网关支持**: 自动尝试多个IPFS网关，提高下载成功率
- **简单操作**: 只需输入CID即可下载
- **智能重试**: 自动切换网关，确保文件可访问
- **友好提示**: 清晰的使用说明和错误提示

**使用方法**：
1. 访问"NFT下载"页面
2. 输入NFT的IPFS CID（通常以"Qm"开头）
3. 点击下载按钮
4. 系统会自动尝试从多个IPFS网关下载文件

**支持的网关**：
- IPFS.io
- Pinata Gateway
- Cloudflare IPFS

## 🛠 技术架构

### 智能合约
- **BlindAuction.sol**: 核心盲拍合约
  - 新增 `biddingStart` 开始时间功能
  - 四阶段状态管理：未开始→竞拍→揭示→结束
  - 自动押金管理和返还机制
- **BlindAuctionFactory.sol**: 拍卖工厂合约
  - 批量创建和管理拍卖
  - 事件日志记录

### 前端技术
- **Next.js 14**: React全栈框架
- **TypeScript**: 类型安全的JavaScript
- **Tailwind CSS**: 现代化CSS框架，紫黑主题
- **Wagmi**: 以太坊钱包连接和交互
- **IPFS**: 去中心化图片存储

### 区块链集成
- **网络支持**: 
  - 本地开发: Hardhat本地节点 (默认)
  - 测试网络: Sepolia测试网 (已注释配置)
- **钱包**: MetaMask
- **存储**: IPFS (Pinata服务)

## 🎨 UI/UX 特色

### 视觉设计
- **主题色彩**: 紫色和黑色为主的现代化设计
- **动态效果**: 流光背景、渐变按钮、悬停动画
- **3D星球展示**: 🆕 首页左侧展示旋转的3D星球，配有规律环绕的陨石带效果
  - 三层陨石环：内中外三层椭圆轨道，以不同速度和方向旋转
  - 粒子闪烁：陨石带中的小白点有规律的闪烁和大小变化效果
  - 彩色变化：部分陨石呈现不同颜色（橙色、绿色），增加视觉层次
  - 物理真实感：小白点严格按照椭圆轨道环绕星球，不再随机乱飞
- **响应式**: 适配手机、平板、桌面端

### 交互体验
- **状态反馈**: 清晰的加载状态和操作反馈
- **错误处理**: 友好的错误提示和重试机制
- **分页导航**: 流畅的分页切换体验

## 🚀 部署说明

### 智能合约部署
```bash
# 启动本地Hardhat节点
cd packages/hardhat
yarn chain
# 在新的终端窗口中部署合约到本地网络
cd packages/hardhat
npx hardhat deploy

# 部署到Sepolia测试网络 (已注释，如需使用请修改scaffold.config.ts)
# npx hardhat deploy --network sepolia --reset
```

### 前端启动
```bash
cd packages/nextjs
npm run dev
```

## 🔄 从Sepolia测试网切换到本地节点

本项目已配置为使用本地Hardhat节点进行开发测试，以下是完整的切换步骤：

### 1. 配置修改
- ✅ **scaffold.config.ts**: 已修改为使用Hardhat本地网络
- ✅ **网络链接**: 已更新区块浏览器为本地浏览器链接
- ✅ **Burner钱包**: 已启用本地开发的Burner钱包功能

### 2. 启动本地区块链
```bash
# 进入hardhat目录
cd packages/hardhat

# 启动本地节点
yarn chain
```
启动后，控制台会显示可用的测试账户和私钥。

### 3. 部署合约到本地网络
在新的终端窗口中执行：
```bash
# 进入hardhat目录
cd packages/hardhat

# 部署智能合约到本地网络
npx hardhat deploy
```

### 4. 启动前端应用
```bash
# 进入nextjs目录
cd packages/nextjs

# 启动开发服务器
npm run dev
```

### 5. 使用MetaMask连接本地网络
1. 在MetaMask中，添加新网络：
   - 网络名称：`Hardhat`
   - RPC URL：`http://localhost:8545`
   - 链ID：`31337`
   - 货币符号：`ETH`

2. 导入测试账户：
   - 复制控制台中显示的私钥之一
   - 在MetaMask中点击"导入账户"
   - 粘贴私钥并完成导入

现在您可以使用本地网络进行测试，无需消耗真实ETH，所有交易都在本地执行。

### 6. 切换回Sepolia测试网
如果需要切回Sepolia测试网，只需修改`scaffold.config.ts`文件：
```typescript
// 从本地Hardhat节点切换回Sepolia测试网络
// targetNetworks: [chains.hardhat],
targetNetworks: [chains.sepolia],

// 在测试网上关闭Burner钱包
onlyLocalBurnerWallet: false,
```

## 📝 使用流程示例

### 创建拍卖流程
1. 连接钱包 → 2. 创建拍卖 → 3. 设置开始时间 → 4. 上传图片 → 5. 提交到区块链

### 参与竞拍流程
1. 浏览拍卖 → 2. 等待开始时间 → 3. 提交盲拍 → 4. 揭示出价 → 5. 查看结果

## 🔧 API优化策略

### 缓存机制
- **已结束拍卖**: 本地缓存，减少重复请求
- **用户拍卖**: 分别缓存创建和参与的拍卖
- **批量加载**: 智能批处理，减少API调用频率

### 性能优化
- **分页加载**: 避免一次性加载大量数据
- **图片压缩**: 自动压缩上传图片
- **懒加载**: 按需加载拍卖数据

## 🆕 v2.0 更新内容

### 新增功能
1. **竞拍开始时间**: 支持设置拍卖何时开始
2. **未开始状态**: 新增"未开始"状态显示和筛选
3. **时间验证**: 防止设置过去的开始时间
4. **状态管理**: 完整的四阶段状态管理
5. **UI优化**: 更新状态标签和过滤器

### 技术改进
1. **合约升级**: 修改智能合约支持开始时间
2. **类型安全**: 更新TypeScript类型定义
3. **错误处理**: 改进错误处理和用户反馈

